---
phase: 02-pixijs-renderer-playable-game
plan: 05
type: execute
wave: 4
depends_on: [02-01, 02-02, 02-03, 02-04]
files_modified: []
autonomous: false
requirements: [UX-06]

must_haves:
  truths:
    - "User can drive the car around the full track in a browser at stable 60fps"
    - "All 5 HUD elements update correctly in real time during driving"
    - "Countdown plays on load, R-key restarts without countdown, Escape pauses"
    - "Respawn triggers after 5 seconds of being stuck, car lands at last checkpoint"
    - "Lap completion is detected, timer resets, lap counter increments"
    - "F key toggles fullscreen"
    - "No console errors during normal play"
    - "No PixiJS imports exist in src/engine/ files"
  artifacts:
    - path: "src/renderer/RendererApp.ts"
      provides: "Fully wired app — all renderers registered and running"
    - path: "src/renderer/WorldRenderer.ts"
      provides: "Track + car rendering with camera"
    - path: "src/renderer/HudRenderer.ts"
      provides: "All 5 HUD elements"
    - path: "src/renderer/OverlayRenderer.ts"
      provides: "Countdown, pause, respawn, lap-complete overlays"
  key_links:
    - from: "src/renderer/GameLoop.ts"
      to: "src/renderer/WorldRenderer.ts"
      via: "onRender callback — WorldRenderer.render(prev, curr, alpha, race, screenW, screenH)"
    - from: "src/renderer/GameLoop.ts"
      to: "src/renderer/HudRenderer.ts"
      via: "onRender callback — HudRenderer.render(prev, curr, alpha, race)"
    - from: "src/renderer/GameLoop.ts"
      to: "src/renderer/OverlayRenderer.ts"
      via: "onRender callback — OverlayRenderer.render(prev, curr, alpha, race)"
---

<objective>
Final integration verification: confirm the complete playable game works end-to-end in a browser. This plan has no code changes — it's the human checkpoint that validates Phase 2 is complete.

Purpose: Plans 01-04 were built and verified in pieces. This final checkpoint ensures everything works together as a unified playable experience, catches any integration gaps, and confirms all 14 Phase 2 requirements are met.

Output: Human-verified confirmation that Phase 2 is complete and the game is playable.
</objective>

<execution_context>
@~/.claude/commands/gsd/workflows/execute-plan.md
@~/.claude/commands/gsd/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/02-pixijs-renderer-playable-game/02-01-SUMMARY.md
@.planning/phases/02-pixijs-renderer-playable-game/02-02-SUMMARY.md
@.planning/phases/02-pixijs-renderer-playable-game/02-03-SUMMARY.md
@.planning/phases/02-pixijs-renderer-playable-game/02-04-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Final integration audit</name>
  <files></files>
  <action>
Run these verification checks before the human checkpoint. Fix any issues found.

**Check 1: TypeScript clean compile**
```bash
cd "C:/Users/brigg/ai-learning-journey/projects/top-down-racer-02"
pnpm exec tsc --noEmit
```
Expected: 0 errors. Fix any errors before proceeding.

**Check 2: No PixiJS imports in engine (CLAUDE.md constraint)**
```bash
grep -r "pixi" src/engine/ --include="*.ts"
```
Expected: no output. If any found, this is a critical violation — remove them.

**Check 3: All renderer files exist**
```bash
ls src/renderer/
```
Expected files: RendererApp.ts, GameLoop.ts, GameState.ts, InputHandler.ts,
WorldRenderer.ts, CameraController.ts, TrackRenderer.ts, CarRenderer.ts,
HudRenderer.ts, OverlayRenderer.ts

**Check 4: GameLoop registers all three onRender callbacks**
Search RendererApp.ts for `onRender` — should appear 3 times (WorldRenderer, HudRenderer, OverlayRenderer).
```bash
grep -c "onRender" src/renderer/RendererApp.ts
```
Expected: 3

**Check 5: Dev server starts without errors**
```bash
pnpm dev &
sleep 3
# Check for build errors in output
```
If the dev server fails to start, diagnose and fix before the human checkpoint.

Fix any issues found. If TypeScript errors exist in Plans 02-04 output files, fix them now.
  </action>
  <verify>
    <automated>cd "C:/Users/brigg/ai-learning-journey/projects/top-down-racer-02" && pnpm exec tsc --noEmit 2>&1 | grep -c "error TS" | xargs -I{} test {} -eq 0 && echo "PASS: 0 TypeScript errors" || echo "FAIL: TypeScript errors found"</automated>
  </verify>
  <done>
    TypeScript compiles with 0 errors.
    No PixiJS imports in src/engine/.
    All renderer files exist.
    3 onRender callbacks registered.
    Dev server starts without build errors.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
    Complete Phase 2: playable top-down racer in the browser with:
    - Track rendered with colored surfaces (dark grey road, tan runoff, red-brown walls)
    - Checkered finish line
    - Car sprite (rectangle + pointed nose) following physics
    - Car-facing-up camera with dynamic zoom
    - All 5 HUD elements (speedometer, lap time, best lap, lap counter, minimap)
    - Countdown on load (3-2-1-GO)
    - Pause menu (Escape)
    - Instant restart (R key)
    - Respawn after 5-second stuck timeout
    - Lap complete overlay
    - Fullscreen toggle (F key)
    - Loading screen on initial load
  </what-built>
  <how-to-verify>
    Run `pnpm dev` and open http://localhost:5173. Work through this checklist:

    **Loading (UX-05):**
    [ ] Loading screen shows "Top-Down Racer" + progress bar on first open
    [ ] Transitions to game canvas after 1-2 frames

    **Countdown (MECH-12):**
    [ ] 3... 2... 1... GO! sequence plays on first load
    [ ] Each beat takes ~1 second
    [ ] Track and car visible behind countdown (driving camera, not cinematic)

    **Driving:**
    [ ] WASD and Arrow keys both control the car
    [ ] Car moves smoothly (no jerking or teleporting)
    [ ] Car sprite rotation looks smooth through turns

    **Camera (VIS-01, VIS-02):**
    [ ] Car always points toward screen top
    [ ] Camera zooms out slightly at high speed
    [ ] Extra zoom-out visible during hard slides/oversteer

    **Track (VIS-05):**
    [ ] Dark grey road surface, light tan runoff, red-brown wall boundary
    [ ] Checkered finish line visible at start/finish

    **HUD (HUD-01 through HUD-05):**
    [ ] Speedometer bar (bottom-left) fills as car accelerates
    [ ] Current lap time (top-right) counts up in M:SS.mmm format
    [ ] Best lap shows "Best: --:--.---" before first completion
    [ ] Lap counter shows "LAP 1" at top-left
    [ ] Minimap (bottom-right) shows track outline + yellow car dot moving

    **Lap completion:**
    [ ] Completing a lap resets current lap timer
    [ ] Lap counter increments to "LAP 2"
    [ ] Best lap time populates after first completion
    [ ] New best flashes green (complete another faster lap to verify)
    [ ] Brief "Lap N" overlay appears center-screen and fades in ~1s

    **Respawn (MECH-13):**
    [ ] Drive into a wall, hold still for 5 seconds
    [ ] Fade to black, then car reappears at the last checkpoint facing forward
    [ ] Immediate control after respawn

    **UX controls:**
    [ ] R key: instant reset — car at start, no countdown
    [ ] Escape: pause overlay appears ("PAUSED" + "Press ESC to Resume")
    [ ] Escape again: game resumes
    [ ] F key: fullscreen toggle works

    **Performance:**
    [ ] Game runs at smooth 60fps (check browser dev tools if unsure)
    [ ] No console errors (check browser console F12)

    **Architecture constraint:**
    [ ] Verified no PixiJS imports in src/engine/ (Task 1 automated check)
  </how-to-verify>
  <resume-signal>
    If all items checked: type "approved — Phase 2 complete"
    If issues found: describe each failing item
  </resume-signal>
</task>

</tasks>

<verification>
All 14 Phase 2 requirements verified by human play-test:
- VIS-01: Camera follows with lerp, car-facing-up
- VIS-02: Car sprite rotation interpolated between ticks
- VIS-05: Checkered finish line at checkpoint[0]
- HUD-01: Speedometer bar scales with speed
- HUD-02: Current lap time running in M:SS.mmm
- HUD-03: Best lap always visible, dashes before first
- HUD-04: Lap counter X/total (shown as LAP X)
- HUD-05: Minimap with track outline + car dot
- MECH-12: 3-2-1-GO countdown on initial load
- MECH-13: 5s stuck timeout → fade-to-black → respawn at last checkpoint
- UX-01: R key instant restart, no countdown
- UX-02: Escape pause/resume, pause-only menu
- UX-05: Loading screen on page load
- UX-06: F key fullscreen toggle
</verification>

<success_criteria>
All 14 Phase 2 requirements are met and verified by human play-test.
The game is playable: drive, lap, restart, pause, respawn all work.
Performance is stable at 60fps.
No architectural violations (engine remains PixiJS-free).
</success_criteria>

<output>
After completion, create `.planning/phases/02-pixijs-renderer-playable-game/02-05-SUMMARY.md`

Also update `.planning/STATE.md`:
- Phase 2 status: Complete
- Update progress: completed_phases: 2, progress to ~33%
</output>
